<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLMctrl | BetConstruct AI Perception Intelligence</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-primary: #fafafa;
            --bg-white: #ffffff;
            --bg-subtle: #f5f5f7;
            --bg-elevated: #ffffff;
            --text-primary: #1a1a2e;
            --text-secondary: #4a4a68;
            --text-muted: #8888a4;
            --border: #e5e5ed;
            --border-light: #f0f0f5;
            --boosting: #06d6a0;
            --boosting-light: #ecfdf5;
            --boosting-border: #a7f3d0;
            --competitive: #e63946;
            --competitive-light: #fef2f2;
            --competitive-border: #fecaca;
            --risk: #dc2626;
            --risk-light: #fef2f2;
            --friction: #f77f00;
            --friction-light: #fffbeb;
            --friction-border: #fde68a;
            --neutral: #6b7280;
            --neutral-light: #f3f4f6;
            --invisible: #9ca3af;
            --invisible-light: #f9fafb;
            --info: #4361ee;
            --info-light: #eef2ff;
            --accent: #7209b7;
            --accent-light: #f5f3ff;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.05);
            --shadow-lg: 0 12px 40px rgba(0,0,0,0.08);
            --shadow-xl: 0 24px 60px rgba(0,0,0,0.12);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        .header {
            background: var(--bg-white);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
            background: rgba(255,255,255,0.9);
        }

        .header-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-img { height: 28px; width: auto; filter: invert(1) brightness(0.2); }

        .logo-divider {
            width: 1px;
            height: 24px;
            background: var(--border);
        }

        .logo-text {
            font-size: 1.1rem;
            font-weight: 700;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-meta { display: flex; gap: 1.5rem; align-items: center; }

        .header-stat {
            text-align: center;
            padding: 0.5rem 1rem;
            background: var(--bg-subtle);
            border-radius: 8px;
        }

        .header-stat-value {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .header-stat-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 0.15rem;
        }

        .brand-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .brand-logo {
            height: 24px;
            width: auto;
            object-fit: contain;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }

        /* Layer badges */
        .layer-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.3rem 0.7rem;
            border-radius: 6px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .layer-badge.sourced { background: #dbeafe; color: #1d4ed8; }
        .layer-badge.measured { background: #dcfce7; color: #16a34a; }
        .layer-badge.model { background: #fef3c7; color: #d97706; }

        /* Section styles */
        .section {
            background: var(--bg-white);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .section-subtitle {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Hero Section */
        .hero {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 2.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .hero-dark {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            border: none;
        }

        .hero-flex {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .hero-content {
            flex: 1;
            min-width: 280px;
        }

        .hero-badge-risk {
            background: rgba(239,68,68,0.2);
            color: #fca5a5;
            border: 1px solid rgba(239,68,68,0.3);
        }

        .hero-dark .hero-title {
            color: white;
            font-size: 1.5rem;
            margin-top: 1rem;
        }

        .hero-highlight {
            color: #f97316;
        }

        .hero-dark .hero-subtitle {
            color: rgba(255,255,255,0.7);
            margin-top: 1rem;
        }

        .hero-stat-box {
            background: rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 1.5rem;
            min-width: 180px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .hero-stat-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: rgba(255,255,255,0.5);
            letter-spacing: 1px;
        }

        .hero-stat-value {
            font-size: 3rem;
            font-weight: 800;
            color: #f97316;
        }

        .hero-stat-detail {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.6);
        }

        .hero-stat-warning {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 0.65rem;
            color: #fbbf24;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(114, 9, 183, 0.05) 0%, transparent 70%);
            pointer-events: none;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--accent-light);
            color: var(--accent);
            padding: 0.4rem 0.9rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 1rem;
        }

        .hero-title {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }

        .hero-subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            max-width: 700px;
        }

        /* How to read section */
        .how-to-read {
            background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);
            border: 1px solid #fde047;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .how-to-read-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .how-to-read-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .how-to-read-text a {
            color: var(--info);
            text-decoration: none;
        }

        .how-to-read-text a:hover {
            text-decoration: underline;
        }

        .signal-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }

        .signal-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
        }

        .signal-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .signal-dot.boosting { background: var(--boosting); }
        .signal-dot.competitive { background: var(--competitive); }
        .signal-dot.risk { background: var(--risk); }
        .signal-dot.friction { background: var(--friction); }
        .signal-dot.neutral { background: var(--neutral); }
        .signal-dot.invisible { background: var(--invisible); }

        /* LLM Sources */
        .llm-sources-section {
            background: var(--bg-white);
            border-radius: 16px;
            padding: 1.5rem 2rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .llm-sources-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .llm-sources-subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .llm-logos {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .llm-logo-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .llm-logo {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.2s;
        }

        .llm-logo img {
            width: 32px;
            height: 32px;
            object-fit: contain;
        }

        .llm-logo svg {
            width: 32px;
            height: 32px;
        }

        .llm-logo.active {
            background: #10a37f;
            box-shadow: 0 4px 12px rgba(16, 163, 127, 0.3);
        }

        .llm-logo-label {
            font-size: 0.7rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .llm-logo-status {
            font-size: 0.6rem;
            font-weight: 600;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            text-transform: uppercase;
        }

        .llm-logo-status.live {
            background: #dcfce7;
            color: #16a34a;
        }

        .llm-logo-status.soon {
            background: var(--bg-subtle);
            color: var(--text-muted);
        }

        .llm-logo.inactive {
            background: var(--bg-subtle);
            border: 1px solid var(--border);
            opacity: 0.5;
            filter: grayscale(100%);
        }

        /* Market Context - Layer 1 */
        .market-context {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border: 1px solid #93c5fd;
        }

        .market-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        .market-stat {
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
            border: 1px solid #bfdbfe;
        }

        .market-stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .market-stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .market-stat-source {
            font-size: 0.65rem;
            color: #3b82f6;
        }

        .market-stat-source a {
            color: #3b82f6;
            text-decoration: none;
        }

        .market-stat-source a:hover {
            text-decoration: underline;
        }

        /* AI Signals - Layer 2 */
        .signals-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .signal-card {
            border-radius: 16px;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .signal-card.boosting {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border: 1px solid var(--boosting-border);
        }

        .signal-card.competitive {
            background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
            border: 1px solid var(--competitive-border);
        }

        .signal-card.risk {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 1px solid #fca5a5;
        }

        .signal-card.friction {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border: 1px solid var(--friction-border);
        }

        .signal-card.neutral {
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            border: 1px solid #d1d5db;
        }

        .signal-card.invisible {
            background: linear-gradient(135deg, #f9fafb 0%, #e5e7eb 100%);
            border: 1px solid #d1d5db;
        }

        .signal-card-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
        }

        .signal-card-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.25rem;
        }

        .signal-card.boosting .signal-card-value { color: var(--boosting); }
        .signal-card.competitive .signal-card-value { color: var(--competitive); }
        .signal-card.risk .signal-card-value { color: var(--risk); }
        .signal-card.friction .signal-card-value { color: var(--friction); }
        .signal-card.neutral .signal-card-value { color: var(--neutral); }
        .signal-card.invisible .signal-card-value { color: var(--invisible); }

        .signal-card-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .signal-card-desc {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .signal-card-percent {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 0.85rem;
            font-weight: 700;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            background: rgba(255,255,255,0.8);
        }

        /* Scenario Model - Layer 3 */
        .scenario-section {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border: 1px solid #fcd34d;
        }

        .scenario-toggle {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .scenario-toggle input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .scenario-toggle label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .scenario-content {
            display: none;
        }

        .scenario-content.active {
            display: block;
        }

        .scenario-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .scenario-input-group {
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            border: 1px solid #fde68a;
        }

        .scenario-input-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .scenario-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
        }

        .scenario-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .scenario-result {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border: 2px solid #f59e0b;
            text-align: center;
        }

        .scenario-result-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .scenario-result-value {
            font-size: 2rem;
            font-weight: 800;
            color: #d97706;
        }

        .scenario-disclaimer {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 1rem;
            font-style: italic;
        }

        /* Sources Section */
        .sources-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .source-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .source-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: var(--bg-subtle);
            border-radius: 8px;
            transition: all 0.2s;
        }

        .source-item:hover {
            background: var(--bg-white);
            box-shadow: var(--shadow-sm);
        }

        .source-icon {
            font-size: 1.25rem;
        }

        .source-info {
            flex: 1;
        }

        .source-domain {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .source-type {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .source-count {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--info);
            background: var(--info-light);
            padding: 0.25rem 0.6rem;
            border-radius: 6px;
        }

        .source-category {
            background: var(--bg-white);
            border-radius: 12px;
            padding: 1.25rem;
            border: 1px solid var(--border);
        }

        .source-category-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Competitive Intelligence */
        .competitor-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .competitor-list {
            background: var(--bg-subtle);
            border-radius: 12px;
            padding: 1.25rem;
        }

        .competitor-list-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .competitor-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .competitor-item:last-child {
            border-bottom: none;
        }

        .competitor-name {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .competitor-count {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--competitive);
            background: var(--competitive-light);
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
        }

        .competitor-bar {
            height: 6px;
            background: var(--border-light);
            border-radius: 3px;
            margin-top: 0.5rem;
            overflow: hidden;
        }

        .competitor-bar-fill {
            height: 100%;
            background: var(--competitive);
            border-radius: 3px;
        }

        /* Risk Watch */
        .risk-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .risk-item {
            background: var(--risk-light);
            border: 1px solid #fca5a5;
            border-radius: 12px;
            padding: 1rem 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .risk-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .risk-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }

        .risk-item-question {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
            flex: 1;
        }

        .risk-item-badge {
            font-size: 0.65rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            background: var(--risk);
            color: white;
            text-transform: uppercase;
        }

        /* Evaluation Table */
        .eval-filters {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .eval-filter {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-white);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .eval-filter:hover {
            border-color: var(--accent);
        }

        .eval-filter.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .eval-search {
            flex: 1;
            min-width: 200px;
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.8rem;
        }

        .eval-table-wrapper {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .eval-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .eval-table th {
            background: var(--bg-subtle);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            font-size: 0.7rem;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border);
        }

        .eval-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-light);
            vertical-align: top;
        }

        .eval-table tr:hover {
            background: var(--bg-subtle);
        }

        .eval-table tr.boosting-row { background: var(--boosting-light); }
        .eval-table tr.competitive-row { background: var(--competitive-light); }
        .eval-table tr.risk-row { background: var(--risk-light); }
        .eval-table tr.friction-row { background: var(--friction-light); }

        .eval-table tr:hover {
            cursor: pointer;
        }

        .label-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .label-badge.boosting { background: var(--boosting-light); color: var(--boosting); border: 1px solid var(--boosting); }
        .label-badge.competitive { background: var(--competitive-light); color: var(--competitive); border: 1px solid var(--competitive); }
        .label-badge.risk { background: var(--risk-light); color: var(--risk); border: 1px solid var(--risk); }
        .label-badge.friction { background: var(--friction-light); color: var(--friction); border: 1px solid var(--friction); }
        .label-badge.neutral { background: var(--neutral-light); color: var(--neutral); border: 1px solid var(--neutral); }
        .label-badge.invisible { background: var(--invisible-light); color: var(--invisible); border: 1px solid var(--invisible); }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(26, 26, 46, 0.6);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: var(--bg-white);
            border-radius: 20px;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            width: 100%;
            box-shadow: var(--shadow-xl);
        }

        .modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: sticky;
            top: 0;
            background: var(--bg-white);
            border-radius: 20px 20px 0 0;
        }

        .modal-title { font-size: 1rem; color: var(--text-primary); line-height: 1.5; max-width: 750px; font-weight: 600; }

        .modal-close {
            background: var(--bg-subtle);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            font-size: 1.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-body { padding: 2rem; }

        .modal-section {
            margin-bottom: 1.5rem;
        }

        .modal-section-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 0.75rem;
        }

        .modal-answer {
            background: var(--bg-subtle);
            border-radius: 12px;
            padding: 1.25rem;
            font-size: 0.85rem;
            line-height: 1.7;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .modal-triggers {
            display: flex;
            gap: 1rem;
        }

        .modal-trigger-box {
            flex: 1;
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.8rem;
        }

        .modal-trigger-box.positive {
            background: var(--boosting-light);
            border: 1px solid var(--boosting-border);
        }

        .modal-trigger-box.negative {
            background: var(--competitive-light);
            border: 1px solid var(--competitive-border);
        }

        .modal-competitors {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .modal-competitor-tag {
            background: var(--competitive-light);
            color: var(--competitive);
            padding: 0.35rem 0.75rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* Methodology */
        .methodology-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .methodology-item {
            background: var(--bg-subtle);
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
        }

        .methodology-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--accent);
            margin-bottom: 0.25rem;
        }

        .methodology-label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Work hours banner */
        .work-hours-banner {
            background: linear-gradient(135deg, #059669 0%, #10b981 50%, #34d399 100%);
            border-radius: 16px;
            padding: 1.5rem 2rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3);
        }

        .work-hours-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: white;
            line-height: 1;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .work-hours-text {
            color: white;
            font-size: 0.95rem;
            line-height: 1.5;
            max-width: 500px;
        }

        .work-hours-text strong {
            font-weight: 700;
        }

        /* CTA */
        .final-cta {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .final-cta::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--gradient-1); }
        .final-cta-title { font-size: 1.5rem; font-weight: 800; color: var(--text-primary); margin-bottom: 0.75rem; }
        .final-cta-subtitle { font-size: 1rem; color: var(--text-secondary); margin-bottom: 2rem; max-width: 550px; margin-left: auto; margin-right: auto; }
        .final-cta-buttons { display: flex; gap: 1rem; justify-content: center; margin-bottom: 1.5rem; }

        .final-cta-primary {
            background: var(--gradient-1);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .final-cta-primary:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }

        .final-cta-secondary {
            background: var(--bg-white);
            color: var(--text-primary);
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }

        .final-cta-secondary:hover { background: var(--bg-primary); }

        .final-cta-guarantees { display: flex; gap: 2rem; justify-content: center; font-size: 0.8rem; color: var(--text-muted); }
        .final-cta-guarantee { display: flex; align-items: center; gap: 0.5rem; }
        .final-cta-guarantee-icon { color: var(--boosting); }

        /* Responsive - Mobile First */
        @media (max-width: 1024px) {
            .signals-grid { grid-template-columns: repeat(2, 1fr); }
            .market-stats { grid-template-columns: repeat(2, 1fr); }
            .scenario-inputs { grid-template-columns: 1fr; }
            .competitor-grid { grid-template-columns: 1fr; }
            .methodology-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            .container { padding: 0.75rem; }
            .header { padding: 0.5rem 0.75rem; }
            .header-inner { flex-direction: column; gap: 0.75rem; }
            .header-meta { gap: 0.4rem; flex-wrap: wrap; justify-content: center; }
            .header-stat { padding: 0.4rem 0.6rem; }
            .header-stat-value { font-size: 0.8rem; }
            .header-stat-label { font-size: 0.55rem; }

            .signals-grid { grid-template-columns: 1fr; gap: 0.75rem; }
            .market-stats { grid-template-columns: 1fr; }

            /* Hero Mobile */
            .hero { padding: 1.25rem; }
            .hero-flex { flex-direction: column; gap: 1.25rem; }
            .hero-content { min-width: 100%; }
            .hero-stat-box { width: 100%; min-width: 100%; padding: 1.25rem; }
            .hero-stat-value { font-size: 2.5rem; }
            .hero-stat-label { font-size: 0.65rem; }
            .hero-stat-detail { font-size: 0.75rem; }
            .hero-stat-warning { font-size: 0.6rem; }
            .hero-title { font-size: 1.1rem !important; line-height: 1.4; }
            .hero-subtitle { font-size: 0.85rem !important; }
            .hero-badge { font-size: 0.6rem; padding: 0.3rem 0.6rem; }

            .section { padding: 1rem; margin-bottom: 1rem; }
            .section-title { font-size: 1rem; }
            .section-subtitle { font-size: 0.75rem; }

            /* LLM Logos Mobile */
            .llm-sources-section { flex-direction: column; text-align: center; gap: 1rem; padding: 1rem; }
            .llm-logos { gap: 0.75rem; }
            .llm-logo { width: 36px; height: 36px; }
            .llm-logo-label { font-size: 0.6rem; }

            /* Tables Mobile */
            .eval-table-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; }
            .eval-table { font-size: 0.7rem; min-width: 600px; }
            .eval-table th, .eval-table td { padding: 0.5rem 0.4rem; }
            .eval-filters { flex-wrap: wrap; gap: 0.4rem; }
            .eval-filter { padding: 0.4rem 0.6rem; font-size: 0.65rem; }
            .eval-search { width: 100%; margin-top: 0.5rem; }

            /* Key Findings Mobile */
            .key-findings-grid { grid-template-columns: 1fr !important; }

            /* Next Actions Mobile */
            #nextActionsContainer > div { padding: 1rem; }
            #nextActionsContainer > div > div:first-child { font-size: 0.6rem; }
            #nextActionsContainer > div > div:nth-child(2) { font-size: 0.95rem; }

            /* Competitor Grid Mobile */
            .competitor-grid { gap: 1rem; }
            .competitor-list { padding: 1rem; }
            .competitor-list-title { font-size: 0.8rem; }

            /* Methodology Mobile */
            .methodology-grid { grid-template-columns: 1fr; gap: 0.75rem; }
            .methodology-item { padding: 1rem; }
            .methodology-value { font-size: 1.5rem; }

            /* Work Hours Banner Mobile */
            .work-hours-banner { flex-direction: column; text-align: center; gap: 0.75rem; padding: 1.25rem; }
            .work-hours-number { font-size: 2rem; }
            .work-hours-text { font-size: 0.8rem; }

            /* Modal Mobile */
            .modal-content { margin: 0.5rem; padding: 1.25rem; max-height: 90vh; }
            .modal-title { font-size: 1rem; }
            .modal-answer { font-size: 0.8rem; max-height: 250px; }

            /* Scenario Calculator Mobile */
            .scenario-inputs { gap: 0.75rem; }
            .scenario-input label { font-size: 0.7rem; }
            .scenario-input input { padding: 0.6rem; font-size: 0.85rem; }
            .scenario-result { font-size: 2rem; }

            /* Export Buttons Mobile */
            .export-buttons { flex-wrap: wrap; gap: 0.5rem; }
            .export-btn { padding: 0.5rem 0.75rem; font-size: 0.7rem; }

            .final-cta { padding: 1.25rem; }
            .final-cta-buttons { flex-direction: column; gap: 0.75rem; }
            .final-cta-title { font-size: 1.1rem; }
        }

        @media (max-width: 480px) {
            .container { padding: 0.5rem; }
            .hero { padding: 1rem; }
            .hero-title { font-size: 1rem !important; }
            .section { padding: 0.875rem; }
            .signals-grid { gap: 0.5rem; }
            .signal-card { padding: 0.875rem; }
            .signal-card-value { font-size: 1.5rem; }
            .signal-card-label { font-size: 0.7rem; }
            .signal-card-desc { font-size: 0.6rem; }

            .eval-table { min-width: 500px; font-size: 0.65rem; }

            .llm-logos { gap: 0.5rem; }
            .llm-logo { width: 32px; height: 32px; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-inner">
            <div class="logo">
                <img src="../logo_iaW1-1536x233-1.webp" alt="Interamplify" class="logo-img">
                <div class="logo-divider"></div>
                <div class="logo-text">LLMctrl</div>
            </div>
            <div class="header-meta">
                <!-- Brand Selector -->
                <div class="header-stat brand-stat" style="position: relative;">
                    <select id="brandSelector" style="position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer;">
                        <option value="betconstruct" selected>BetConstruct</option>
                        <option value="other" disabled>+ Add Brand</option>
                    </select>
                    <img src="../logos/bet.png" alt="BetConstruct" class="brand-logo">
                    <div class="header-stat-label">Brand ‚ñæ</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value">UK</div>
                    <div class="header-stat-label">Market</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value" id="totalQuestions">216</div>
                    <div class="header-stat-label">Questions</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value">Jan 2026</div>
                    <div class="header-stat-label">Report Date</div>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- LLM Sources -->
        <div class="llm-sources-section">
            <div class="llm-sources-info">
                <div class="llm-sources-title">Data Sources</div>
                <div class="llm-sources-subtitle">AI platforms analyzed for this report</div>
            </div>
            <div class="llm-logos">
                <div class="llm-logo-item">
                    <div class="llm-logo active" title="ChatGPT">
                        <svg viewBox="0 0 24 24" fill="white">
                            <path d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.8956zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z"/>
                        </svg>
                    </div>
                    <div class="llm-logo-label">ChatGPT</div>
                    <div class="llm-logo-status live">Live</div>
                </div>
                <div class="llm-logo-item">
                    <div class="llm-logo inactive" title="Gemini - Coming Soon">
                        <img src="../logos/Google_Gemini_logo_2025.svg.png" alt="Gemini">
                    </div>
                    <div class="llm-logo-label">Gemini</div>
                    <div class="llm-logo-status soon">Soon</div>
                </div>
                <div class="llm-logo-item">
                    <div class="llm-logo inactive" title="Claude - Coming Soon">
                        <img src="../logos/Claude_AI_logo.svg.png" alt="Claude">
                    </div>
                    <div class="llm-logo-label">Claude</div>
                    <div class="llm-logo-status soon">Soon</div>
                </div>
                <div class="llm-logo-item">
                    <div class="llm-logo inactive" title="Perplexity - Coming Soon">
                        <img src="../logos/Perplexity-Logo.png" alt="Perplexity">
                    </div>
                    <div class="llm-logo-label">Perplexity</div>
                    <div class="llm-logo-status soon">Soon</div>
                </div>
            </div>
        </div>

        <!-- Hero - CEO First -->
        <div class="hero hero-dark">
            <div class="hero-flex">
                <div class="hero-content">
                    <div class="hero-badge hero-badge-risk">AI Perception Risk Report</div>
                    <h1 class="hero-title">In <span class="hero-highlight" id="heroNegativePercent">44%</span> of AI responses, BetConstruct loses to competitors or faces friction signals.</h1>
                    <p class="hero-subtitle">Based on <strong id="heroTotal">216</strong> real operator questions submitted to ChatGPT. Every response manually classified using 100+ calibration rules.</p>
                </div>
                <div class="hero-stat-box">
                    <div class="hero-stat-label">Negative Signal Rate</div>
                    <div class="hero-stat-value" id="heroNegativeRate">44%</div>
                    <div class="hero-stat-detail"><span id="heroNegativeCount">95</span> of <span id="heroTotalCount">216</span> responses</div>
                    <div class="hero-stat-warning">
                        <span>‚ö†Ô∏è ABOVE TYPICAL B2B THRESHOLD</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- KEY FINDINGS -->
        <div class="section" style="background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%); border-radius: 16px; padding: 2rem; margin-bottom: 2rem;">
            <h2 style="color: white; font-size: 1.25rem; margin-bottom: 1.5rem; font-weight: 700;">üìä Key Findings</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
                <div style="background: rgba(255,255,255,0.1); border-radius: 12px; padding: 1.25rem; border-left: 4px solid #f97316;">
                    <div style="font-size: 2rem; font-weight: 800; color: #f97316;" id="keyFindingCompetitive">31%</div>
                    <div style="color: rgba(255,255,255,0.9); font-size: 0.9rem; line-height: 1.5;">
                        <strong>COMPETITIVE_LOSS:</strong> AI positions rivals as better on specific buying criteria (pricing, CRM, speed-to-market)
                    </div>
                </div>
                <div style="background: rgba(255,255,255,0.1); border-radius: 12px; padding: 1.25rem; border-left: 4px solid #ef4444;">
                    <div style="font-size: 2rem; font-weight: 800; color: #ef4444;" id="keyFindingRisk">11%</div>
                    <div style="color: rgba(255,255,255,0.9); font-size: 0.9rem; line-height: 1.5;">
                        <strong>RISK_SIGNAL:</strong> Real red flags raised (fraud, illegal activity, sanctions, investigations, licensing issues) ‚Äî not generic disclaimers
                    </div>
                </div>
                <div style="background: rgba(255,255,255,0.1); border-radius: 12px; padding: 1.25rem; border-left: 4px solid #22c55e;">
                    <div style="font-size: 2rem; font-weight: 800; color: #22c55e;" id="keyFindingBoosting">38%</div>
                    <div style="color: rgba(255,255,255,0.9); font-size: 0.9rem; line-height: 1.5;">
                        <strong>BOOSTING:</strong> Strong authority signals, but not dominant ‚Äî room for improvement
                    </div>
                </div>
            </div>
        </div>

        <!-- WHAT TO DO ABOUT IT (Next Actions - moved up) -->
        <div class="section" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b;">
            <div class="section-header">
                <div>
                    <h2 class="section-title" style="color: #92400e; font-size: 1.25rem;">üéØ What To Do About It</h2>
                    <p class="section-subtitle" style="color: #a16207;">Top 3 criteria where competitors are winning ‚Äî prioritized by frequency</p>
                </div>
            </div>
            <div id="nextActionsContainer">
                <!-- Populated by JS from Top 3 Criteria -->
            </div>
        </div>

        <!-- LAYER 2: AI Perception Signals (Measured) -->
        <div class="section">
            <div class="section-header">
                <div>
                    <span class="layer-badge measured">Layer 2: Measured</span>
                    <h2 class="section-title">AI Perception Signals</h2>
                    <p class="section-subtitle">Direct measurement of how AI positions BetConstruct in responses</p>
                </div>
            </div>
            <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1.5rem; line-height: 1.6;">
                <strong>Measured directly from LLM responses</strong> to real operator questions. This reflects how AI positions BetConstruct versus competitors or operational barriers ‚Äî signals that may influence operator perception during evaluation.
            </p>
            <div class="signals-grid" id="signalsGrid">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Competitive Intelligence -->
        <div class="section">
            <div class="section-header">
                <div>
                    <span class="layer-badge measured">Layer 2: Measured</span>
                    <h2 class="section-title">Competitive Intelligence</h2>
                    <p class="section-subtitle">When AI positions competitors favorably over BetConstruct</p>
                </div>
            </div>
            <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1.5rem; line-height: 1.6;">
                In <strong>COMPETITIVE_LOSS</strong> responses, AI explicitly or implicitly positions a competitor as superior on specific criteria.
            </p>

            <!-- Competitive Table -->
            <div class="eval-table-wrapper" style="margin-bottom: 1.5rem; min-height: 200px;">
                <table class="eval-table">
                    <thead>
                        <tr>
                            <th>Competitor</th>
                            <th>Primary Winning Criterion</th>
                            <th style="width: 100px;">Occurrences</th>
                            <th style="width: 80px;">Example</th>
                        </tr>
                    </thead>
                    <tbody id="competitorTableBody">
                        <!-- Rendered by JS -->
                    </tbody>
                </table>
            </div>

            <!-- Explicit vs Generic -->
            <div class="competitor-grid">
                <div class="competitor-list">
                    <div class="competitor-list-title" style="display: flex; align-items: center; gap: 0.5rem;">
                        Explicit vs Generic Comparisons
                        <span style="font-size: 0.7rem; cursor: help;" title="Generic framing includes terms like 'other platforms', 'modular providers', 'turnkey solutions', without naming a specific brand.">‚ÑπÔ∏è</span>
                    </div>
                    <div style="padding: 1rem 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                            <div>
                                <div style="font-size: 2rem; font-weight: 800; color: var(--competitive);" id="explicitComparisons">54</div>
                                <div style="font-size: 0.75rem; color: var(--text-muted);">Explicit Competitor Named</div>
                            </div>
                            <div>
                                <div style="font-size: 2rem; font-weight: 800; color: var(--friction);" id="genericComparisons">12</div>
                                <div style="font-size: 0.75rem; color: var(--text-muted);">Generic Category</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="competitor-list">
                    <div class="competitor-list-title">Winning Criteria Distribution</div>
                    <div id="criteriaDistribution" style="padding: 0.5rem 0;">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Competitor Presence -->
        <div class="section">
            <div class="section-header">
                <div>
                    <span class="layer-badge measured">Layer 2: Measured</span>
                    <h2 class="section-title">Competitor Presence in AI Responses</h2>
                    <p class="section-subtitle">Which competitor brands appear most frequently when AI discusses iGaming platforms</p>
                </div>
            </div>
            <div class="eval-table-wrapper">
                <table class="eval-table">
                    <thead>
                        <tr>
                            <th>Competitor</th>
                            <th style="width: 100px;">Mentions</th>
                            <th style="width: 100px;">% of Responses</th>
                            <th style="width: 120px;">Category</th>
                        </tr>
                    </thead>
                    <tbody id="sourcesTableBody">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
            <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 1rem; line-height: 1.6;">
                <strong>Why this matters:</strong> These competitors appear frequently in AI responses, indicating strong "AI presence." Understanding which brands dominate AI mindshare helps prioritize content and positioning strategy.
            </p>
        </div>

        <!-- Risk Watch -->
        <div class="section">
            <div class="section-header">
                <div>
                    <span class="layer-badge measured">Layer 2: Measured</span>
                    <h2 class="section-title">Risk Watch</h2>
                    <p class="section-subtitle">Responses with genuine red flags ‚Äî not generic compliance disclaimers</p>
                </div>
                <div style="background: var(--risk-light); padding: 0.5rem 1rem; border-radius: 8px; border: 1px solid #fca5a5;">
                    <span style="font-size: 1.25rem; font-weight: 800; color: var(--risk);" id="riskCount">23</span>
                    <span style="font-size: 0.75rem; color: var(--risk); margin-left: 0.5rem;">Risk Signals</span>
                </div>
            </div>
            <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem; line-height: 1.6;">
                <strong>Strict calibration:</strong> RISK_SIGNAL is only applied for: <span style="background: var(--risk-light); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.8rem;">fraud</span> <span style="background: var(--risk-light); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.8rem;">illegal</span> <span style="background: var(--risk-light); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.8rem;">unlicensed</span> <span style="background: var(--risk-light); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.8rem;">sanction</span> <span style="background: var(--risk-light); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.8rem;">investigation</span> <span style="background: var(--risk-light); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.8rem;">lawsuit</span>
                <br><span style="font-size: 0.8rem; color: var(--text-muted);">Industry-standard legal disclaimers are excluded from this category.</span>
            </p>
            <div class="eval-table-wrapper">
                <table class="eval-table">
                    <thead>
                        <tr>
                            <th>Question</th>
                            <th style="width: 150px;">Trigger Term</th>
                            <th style="width: 80px;">View</th>
                        </tr>
                    </thead>
                    <tbody id="riskTableBody">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- LAYER 3: Scenario Model -->
        <div class="section scenario-section">
            <div class="section-header">
                <div>
                    <span class="layer-badge model">Layer 3: Model</span>
                    <h2 class="section-title">Directional Exposure Scenario</h2>
                    <p class="section-subtitle">Optional hypothetical model ‚Äî not measured impact</p>
                </div>
            </div>
            <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem; line-height: 1.6;">
                This model uses <strong>your assumptions</strong> to estimate potential exposure. Actual impact depends on your sales funnel and conversion metrics ‚Äî these figures are directional only.
            </p>

            <!-- Measured Rate Box -->
            <div style="background: white; border: 2px solid #f59e0b; border-radius: 12px; padding: 1rem 1.5rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 1rem;">
                <div>
                    <div style="font-size: 0.7rem; text-transform: uppercase; color: var(--text-muted); font-weight: 600;">Measured Negative Signal Rate</div>
                    <div style="font-size: 1.75rem; font-weight: 800; color: #d97706;" id="measuredNegativeRate">44%</div>
                </div>
                <div style="font-size: 0.8rem; color: var(--text-secondary); line-height: 1.5; flex: 1;">
                    Based on <span id="negativeCount">95</span> responses classified as COMPETITIVE_LOSS, RISK_SIGNAL, or FRICTION out of 216 total.
                </div>
            </div>

            <div class="scenario-toggle">
                <input type="checkbox" id="scenarioToggle">
                <label for="scenarioToggle">Enable scenario calculator (uses your inputs + measured rate above)</label>
            </div>
            <div class="scenario-content" id="scenarioContent">
                <div class="scenario-inputs">
                    <div class="scenario-input-group">
                        <div class="scenario-input-label">% of leads influenced by AI discovery</div>
                        <input type="number" class="scenario-input" id="aiInfluence" value="15" min="0" max="100">
                    </div>
                    <div class="scenario-input-group">
                        <div class="scenario-input-label">Average deal size ($)</div>
                        <input type="number" class="scenario-input" id="dealSize" value="500000" min="0">
                    </div>
                    <div class="scenario-input-group">
                        <div class="scenario-input-label">Annual pipeline ($M)</div>
                        <input type="number" class="scenario-input" id="pipeline" value="50" min="0">
                    </div>
                </div>
                <div class="scenario-result">
                    <div class="scenario-result-label">Directional Exposure Estimate (Based on Your Inputs)</div>
                    <div class="scenario-result-value" id="scenarioResult">$2.3M</div>
                </div>
                <p class="scenario-disclaimer">
                    <strong>This is a hypothetical scenario, not measured impact.</strong> The calculation uses: (Your Pipeline) √ó (Your AI Influence %) √ó (Measured Negative Signal Rate). Actual impact depends entirely on your specific conversion rates, buyer behavior, and how much weight prospects place on AI recommendations.
                </p>
            </div>
        </div>

        <!-- Evaluation Matrix -->
        <div class="section">
            <div class="section-header">
                <div>
                    <h2 class="section-title">Full Evaluation Matrix</h2>
                    <p class="section-subtitle">All 216 questions analyzed with AI perception signals</p>
                </div>
            </div>
            <div class="eval-filters">
                <button class="eval-filter active" data-filter="all">All (<span id="filterCountAll">216</span>)</button>
                <button class="eval-filter" data-filter="BOOSTING">Boosting (<span id="filterCountBoosting">83</span>)</button>
                <button class="eval-filter" data-filter="COMPETITIVE_LOSS">Competitive (<span id="filterCountCompetitive">66</span>)</button>
                <button class="eval-filter" data-filter="RISK_SIGNAL">Risk (<span id="filterCountRisk">23</span>)</button>
                <button class="eval-filter" data-filter="FRICTION">Friction (<span id="filterCountFriction">6</span>)</button>
                <button class="eval-filter" data-filter="NEUTRAL">Neutral (<span id="filterCountNeutral">24</span>)</button>
                <button class="eval-filter" data-filter="NO_MENCIONA_LA_MARCA">Not Mentioned (<span id="filterCountInvisible">14</span>)</button>
                <input type="text" class="eval-search" placeholder="Search questions..." id="evalSearch">
            </div>
            <div class="eval-table-wrapper">
                <table class="eval-table">
                    <thead>
                        <tr>
                            <th style="width: 80px;">Date</th>
                            <th>Question</th>
                            <th style="width: 110px;">Business Label</th>
                            <th style="width: 130px;">Competitors</th>
                            <th style="width: 150px;">Trigger</th>
                            <th style="width: 70px;">Source</th>
                            <th style="width: 60px;">View</th>
                        </tr>
                    </thead>
                    <tbody id="evalTableBody">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Methodology -->
        <div class="section">
            <div class="section-header">
                <div>
                    <h2 class="section-title">Methodology</h2>
                    <p class="section-subtitle">How this analysis was conducted</p>
                </div>
            </div>
            <div class="methodology-grid">
                <div class="methodology-item">
                    <div class="methodology-value" id="methodologyAnswers">216</div>
                    <div class="methodology-label">AI-Generated Answers</div>
                </div>
                <div class="methodology-item">
                    <div class="methodology-value">100+</div>
                    <div class="methodology-label">Human Calibration Rules</div>
                </div>
                <div class="methodology-item">
                    <div class="methodology-value">6</div>
                    <div class="methodology-label">Business Signal Categories</div>
                </div>
            </div>
            <div style="margin-top: 1.5rem; font-size: 0.85rem; color: var(--text-secondary); line-height: 1.8;">
                <ul style="margin: 0; padding-left: 1.5rem;">
                    <li><strong><span id="methodologyCount">216</span> AI-generated answers</strong> from ChatGPT to real operator questions</li>
                    <li><strong>Manual decision rules</strong> calibrated by human analyst (not automated sentiment)</li>
                    <li><strong>Full-text evaluation</strong> (no fragment scoring) ‚Äî each answer read in context</li>
                    <li><strong>Competitor extraction</strong> + evidence tagging with trigger phrases</li>
                    <li><strong>Risk signals require legal red flags</strong> (fraud, illegal, sanctions) ‚Äî not disclaimers</li>
                    <li><strong>Criterion-based competitive analysis</strong> ‚Äî not just "mention counts"</li>
                </ul>
            </div>
        </div>

        <!-- Work Hours Banner -->
        <div class="work-hours-banner" style="cursor: help; position: relative;" title="Breakdown: ~20h question research & curation, ~30h prompt execution & response capture, ~25h manual classification & calibration, ~10h competitor/trigger extraction & QA">
            <div class="work-hours-number">+80h</div>
            <div class="work-hours-text">
                <strong>This analysis represents over 80 hours of research</strong> ‚Äî querying 216 questions, manually classifying each response, extracting competitor mentions, and documenting evidence. Delivered to you in minutes.
                <div style="font-size: 0.7rem; opacity: 0.8; margin-top: 0.5rem;">Hover for breakdown ‚ÑπÔ∏è</div>
            </div>
        </div>

        <!-- Export Section -->
        <div class="section">
            <div class="section-header">
                <div>
                    <h2 class="section-title">Export & Share</h2>
                    <p class="section-subtitle">Download data or share this report</p>
                </div>
            </div>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <button onclick="exportCSV()" class="final-cta-secondary" style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>üìä</span> Download CSV
                </button>
                <button onclick="exportPDF()" class="final-cta-secondary" style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>üìÑ</span> Download PDF Report
                </button>
                <button onclick="copyShareableLink()" class="final-cta-secondary" style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>üîó</span> Copy Shareable Link
                </button>
            </div>
        </div>

        <!-- CTA -->
        <div class="final-cta">
            <h2 class="final-cta-title">Ready to optimize your AI perception?</h2>
            <p class="final-cta-subtitle">Our team can help you develop a strategy to improve how AI positions BetConstruct.</p>
            <div class="final-cta-buttons">
                <button class="final-cta-primary">Request Strategy Session</button>
                <button class="final-cta-secondary" onclick="exportCSV()">Download Full Data</button>
            </div>
            <div class="final-cta-guarantees">
                <div class="final-cta-guarantee"><span class="final-cta-guarantee-icon">‚úì</span>No commitment</div>
                <div class="final-cta-guarantee"><span class="final-cta-guarantee-icon">‚úì</span>Custom analysis</div>
                <div class="final-cta-guarantee"><span class="final-cta-guarantee-icon">‚úì</span>Actionable recommendations</div>
            </div>
        </div>
    </main>

    <!-- Modal -->
    <div class="modal-overlay" id="modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle"></div>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <div class="modal-section-title">Signal Classification & Decision Rule</div>
                    <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                        <div id="modalSignal"></div>
                        <div id="modalDecisionRule" style="font-size: 0.8rem; color: var(--text-muted); background: var(--bg-subtle); padding: 0.5rem 0.75rem; border-radius: 6px;"></div>
                    </div>
                </div>
                <div class="modal-section" id="modalCompetitorsSection">
                    <div class="modal-section-title">Competitors Mentioned</div>
                    <div class="modal-competitors" id="modalCompetitors"></div>
                </div>
                <div class="modal-section" id="modalTriggersSection">
                    <div class="modal-section-title">Evidence (Trigger Phrases)</div>
                    <div class="modal-triggers" id="modalTriggers"></div>
                </div>
                <div class="modal-section">
                    <div class="modal-section-title">Full AI Response</div>
                    <div class="modal-answer" id="modalAnswer"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data will be embedded here
        const analysisData = [];

        // ============================================
        // CRITERIA ENGINE - Maps trigger_negative to buying criteria
        // ============================================
        const CRITERIA_MAP = {
            "Implementation Speed / Onboarding": ["setup", "onboarding", "integration", "deploy", "implementation", "time", "slow", "fast", "quick", "rapid", "time to market", "launch", "go-live"],
            "Pricing Transparency / Cost": ["price", "pricing", "cost", "expensive", "transparent", "negotiation", "cheaper", "affordable", "budget", "fee"],
            "Scalability / Flexibility": ["scale", "scalable", "flexible", "microservices", "architecture", "modular", "customiz", "api"],
            "CRM / Marketing Depth": ["crm", "marketing", "automation", "segmentation", "customer relationship", "retention", "loyalty", "gamification", "engagement"],
            "Startup-Friendliness / Accessibility": ["startup", "small", "early-stage", "accessible", "too complex", "too costly", "new operator", "entry", "beginner", "simple"],
            "Regulatory / Compliance Strength": ["regulatory", "license", "jurisdiction", "legal", "compliance", "regulat", "licens"],
            "Content / Partnerships / Ecosystem": ["content", "partnership", "ecosystem", "portfolio", "games", "provider", "aggregat"]
        };

        // Assign criterion to an item based on trigger_negative
        function assignCriterion(item) {
            const text = (item.trigger_negative || '').toLowerCase();
            for (const [criterion, keywords] of Object.entries(CRITERIA_MAP)) {
                if (keywords.some(kw => text.includes(kw))) {
                    return criterion;
                }
            }
            return null; // No match
        }

        // Precomputed aggregates (populated after data load)
        let aggregates = {
            counts: {},
            criteria: {},
            competitorsByCriterion: {},
            competitorsOverall: {},
            riskItems: [],
            negativeRate: 0
        };
    </script>
    <script>
        // Load data from JSONL
        async function loadData() {
            try {
                const response = await fetch('betconstruct_llm_reputation_classified_calibrated.jsonl');
                const text = await response.text();
                const lines = text.trim().split('\n');
                lines.forEach(line => {
                    if (line.trim()) {
                        analysisData.push(JSON.parse(line));
                    }
                });
                precomputeAggregates();
                initDashboard();
            } catch (error) {
                console.error('Error loading data:', error);
                initDashboard();
            }
        }

        // Precompute all aggregates at load (no Loading states)
        function precomputeAggregates() {
            const counts = {
                BOOSTING: 0,
                COMPETITIVE_LOSS: 0,
                RISK_SIGNAL: 0,
                FRICTION: 0,
                NEUTRAL: 0,
                NO_MENCIONA_LA_MARCA: 0
            };

            const criteria = {};
            const competitorsByCriterion = {};
            const competitorsOverall = {};
            const riskItems = [];

            analysisData.forEach(item => {
                // Count by label
                if (counts.hasOwnProperty(item.business_label)) {
                    counts[item.business_label]++;
                }

                // Process COMPETITIVE_LOSS items
                if (item.business_label === 'COMPETITIVE_LOSS') {
                    const criterion = assignCriterion(item);
                    if (criterion) {
                        criteria[criterion] = (criteria[criterion] || 0) + 1;

                        // Track competitors by criterion
                        if (!competitorsByCriterion[criterion]) {
                            competitorsByCriterion[criterion] = {};
                        }

                        if (item.competitors) {
                            item.competitors.split(';').forEach(c => {
                                const comp = c.trim();
                                if (comp) {
                                    competitorsByCriterion[criterion][comp] = (competitorsByCriterion[criterion][comp] || 0) + 1;

                                    // Overall competitor count
                                    if (!competitorsOverall[comp]) {
                                        competitorsOverall[comp] = { count: 0, criteria: {}, examples: [] };
                                    }
                                    competitorsOverall[comp].count++;
                                    competitorsOverall[comp].criteria[criterion] = (competitorsOverall[comp].criteria[criterion] || 0) + 1;
                                    if (competitorsOverall[comp].examples.length < 3) {
                                        competitorsOverall[comp].examples.push(item.id);
                                    }
                                }
                            });
                        }
                    }
                }

                // Collect RISK_SIGNAL items
                if (item.business_label === 'RISK_SIGNAL') {
                    riskItems.push(item);
                }
            });

            // Calculate negative rate
            const negativeSignals = counts.COMPETITIVE_LOSS + counts.RISK_SIGNAL + counts.FRICTION;
            const negativeRate = (negativeSignals / analysisData.length) * 100;

            aggregates = {
                counts,
                criteria,
                competitorsByCriterion,
                competitorsOverall,
                riskItems,
                negativeRate,
                negativeCount: negativeSignals
            };

            console.log('Aggregates computed:', aggregates);
        }

        function initDashboard() {
            renderKeyFindings();
            renderSignals();
            renderTopCriteria();
            renderCompetitorTable();
            renderCompetitorPresence();
            renderRiskWatch();
            renderSourcesFromAnswers();
            renderTable();
            setupFilters();
            setupScenario();
            renderNextActions();
        }

        // ============================================
        // KEY FINDINGS - Autogenerated from counts
        // ============================================
        function renderKeyFindings() {
            const total = analysisData.length;
            const { counts } = aggregates;

            const competitivePercent = ((counts.COMPETITIVE_LOSS / total) * 100).toFixed(0);
            const riskPercent = ((counts.RISK_SIGNAL / total) * 100).toFixed(0);
            const boostingPercent = ((counts.BOOSTING / total) * 100).toFixed(0);

            document.getElementById('keyFindingCompetitive').textContent = competitivePercent + '%';
            document.getElementById('keyFindingRisk').textContent = riskPercent + '%';
            document.getElementById('keyFindingBoosting').textContent = boostingPercent + '%';

            // Update Hero stats
            document.getElementById('heroNegativePercent').textContent = aggregates.negativeRate.toFixed(0) + '%';
            document.getElementById('heroNegativeRate').textContent = aggregates.negativeRate.toFixed(0) + '%';
            document.getElementById('heroNegativeCount').textContent = aggregates.negativeCount;
            document.getElementById('heroTotal').textContent = total;
            document.getElementById('heroTotalCount').textContent = total;

            // Update measured rate in Scenario Calculator
            document.getElementById('measuredNegativeRate').textContent = aggregates.negativeRate.toFixed(0) + '%';
            document.getElementById('negativeCount').textContent = aggregates.negativeCount;
        }

        // ============================================
        // AI PERCEPTION SIGNALS
        // ============================================
        function renderSignals() {
            const { counts } = aggregates;
            const total = analysisData.length;
            const grid = document.getElementById('signalsGrid');

            const signals = [
                { key: 'BOOSTING', label: 'Boosting', desc: 'AI strengthens trust & authority', icon: 'üìà', class: 'boosting', tooltip: 'Triggered when AI highlights positives (innovation, partnerships, global presence, scalability, awards) without meaningful disadvantages.' },
                { key: 'COMPETITIVE_LOSS', label: 'Competitive Loss', desc: 'Competitor positioned better', icon: '‚öîÔ∏è', class: 'competitive', tooltip: 'Triggered when AI positions a competitor or competitor category as stronger on a specific buying criterion.' },
                { key: 'RISK_SIGNAL', label: 'Risk Signal', desc: 'Legal/ethical flags raised', icon: '‚ö†Ô∏è', class: 'risk', tooltip: 'Triggered ONLY for true red flags: fraud, illegal, unlicensed, sanctions, investigation, lawsuit. Generic disclaimers are NEUTRAL.' },
                { key: 'FRICTION', label: 'Friction', desc: 'Adoption barriers highlighted', icon: 'üöß', class: 'friction', tooltip: 'Triggered when AI highlights adoption barriers without a clear competitor winner.' },
                { key: 'NEUTRAL', label: 'Neutral', desc: 'Factual, balanced information', icon: 'üìä', class: 'neutral', tooltip: 'Factual, balanced, or industry-standard statements.' },
                { key: 'NO_MENCIONA_LA_MARCA', label: 'Not Mentioned', desc: 'Brand absent from response', icon: 'üëª', class: 'invisible', tooltip: 'AI response does not mention BetConstruct ‚Äî visibility gap.' }
            ];

            grid.innerHTML = signals.map(s => `
                <div class="signal-card ${s.class}" title="${s.tooltip}" style="cursor: help;">
                    <div class="signal-card-icon">${s.icon}</div>
                    <div class="signal-card-value">${counts[s.key] || 0}</div>
                    <div class="signal-card-label">${s.label} <span style="font-size: 0.7rem; opacity: 0.7;">‚ÑπÔ∏è</span></div>
                    <div class="signal-card-desc">${s.desc}</div>
                    <div class="signal-card-percent">${((counts[s.key] / total) * 100).toFixed(1)}%</div>
                </div>
            `).join('');
        }

        // ============================================
        // TOP 3 WINNING CRITERIA - Dynamic from dataset
        // ============================================
        function renderTopCriteria() {
            const { criteria, competitorsByCriterion } = aggregates;

            // Sort criteria by count
            const sortedCriteria = Object.entries(criteria)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 6);

            const maxCount = sortedCriteria[0]?.[1] || 1;

            // Render criteria distribution
            document.getElementById('criteriaDistribution').innerHTML = sortedCriteria.map(([criterion, count]) => {
                // Get top competitors for this criterion
                const competitorsForCriterion = competitorsByCriterion[criterion] || {};
                const topCompetitors = Object.entries(competitorsForCriterion)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3)
                    .map(([name]) => name)
                    .join(', ');

                return `
                    <div style="margin-bottom: 0.75rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 0.25rem;">
                            <span style="font-weight: 600;">${criterion}</span>
                            <span style="color: var(--competitive); font-weight: 700;">${count}</span>
                        </div>
                        <div style="height: 6px; background: var(--border-light); border-radius: 3px; overflow: hidden;">
                            <div style="height: 100%; width: ${(count / maxCount) * 100}%; background: var(--competitive); border-radius: 3px;"></div>
                        </div>
                        ${topCompetitors ? `<div style="font-size: 0.7rem; color: var(--text-muted); margin-top: 0.25rem;">Top: ${topCompetitors}</div>` : ''}
                    </div>
                `;
            }).join('');

            // Calculate explicit vs generic
            let explicit = 0, generic = 0;
            analysisData.forEach(item => {
                if (item.business_label === 'COMPETITIVE_LOSS') {
                    if (item.secondary_label === 'COMPARATIVA_DESFAVORABLE_GENERIC') {
                        generic++;
                    } else {
                        explicit++;
                    }
                }
            });
            document.getElementById('explicitComparisons').textContent = explicit;
            document.getElementById('genericComparisons').textContent = generic;
        }

        // ============================================
        // COMPETITIVE INTELLIGENCE TABLE
        // ============================================
        function renderCompetitorTable() {
            const { competitorsOverall } = aggregates;
            const tableBody = document.getElementById('competitorTableBody');

            const sorted = Object.entries(competitorsOverall)
                .sort((a, b) => b[1].count - a[1].count)
                .slice(0, 12);

            if (sorted.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--text-muted); padding: 2rem;">No competitor data in COMPETITIVE_LOSS responses</td></tr>';
                return;
            }

            tableBody.innerHTML = sorted.map(([name, data]) => {
                // Find primary criterion (most frequent for this competitor)
                const primaryCriterion = Object.entries(data.criteria)
                    .sort((a, b) => b[1] - a[1])[0]?.[0] || 'general';
                const exampleId = data.examples[0];

                return `
                    <tr>
                        <td><strong>${name}</strong></td>
                        <td><span style="background: var(--competitive-light); color: var(--competitive); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.7rem;">${primaryCriterion}</span></td>
                        <td style="text-align: center;"><span class="competitor-count">${data.count}</span></td>
                        <td style="text-align: center;">
                            ${exampleId ? `<button onclick="openModal('${exampleId}')" style="background: var(--info-light); color: var(--info); border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.7rem;">View</button>` : '-'}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ============================================
        // COMPETITOR PRESENCE TABLE (from competitor field)
        // ============================================
        function renderCompetitorPresence() {
            const { competitorsOverall } = aggregates;
            const tableBody = document.getElementById('sourcesTableBody');
            const total = analysisData.length;

            const sorted = Object.entries(competitorsOverall)
                .sort((a, b) => b[1].count - a[1].count)
                .slice(0, 12);

            if (sorted.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--text-muted); padding: 2rem;">No competitor mentions found</td></tr>';
                return;
            }

            tableBody.innerHTML = sorted.map(([name, data]) => {
                const percentage = ((data.count / total) * 100).toFixed(1);
                return `
                    <tr>
                        <td><strong>${name}</strong></td>
                        <td style="text-align: center;"><span class="competitor-count">${data.count}</span></td>
                        <td style="text-align: center;">${percentage}%</td>
                        <td><span style="background: var(--competitive-light); color: var(--competitive); padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem;">Competitor</span></td>
                    </tr>
                `;
            }).join('');
        }

        // ============================================
        // SOURCES FROM ANSWERS - Extract domains via regex
        // ============================================
        function renderSourcesFromAnswers() {
            const domainCounts = {};
            const domainRegex = /https?:\/\/([^\/\s]+)/g;

            analysisData.forEach(item => {
                const answer = item.answer || '';
                let match;
                while ((match = domainRegex.exec(answer)) !== null) {
                    const domain = match[1].toLowerCase().replace('www.', '');
                    if (domain.length > 3 && !domain.includes('e.g') && !domain.includes('i.e')) {
                        domainCounts[domain] = (domainCounts[domain] || 0) + 1;
                    }
                }
            });

            // Log for debugging
            console.log('Domains extracted from answers:', domainCounts);
        }

        // ============================================
        // RISK WATCH TABLE with Trigger Term + Evidence
        // ============================================
        function renderRiskWatch() {
            const riskKeywords = ['fraud', 'illegal', 'unlicensed', 'sanction', 'investigation', 'lawsuit', 'scam', 'criminal', 'money laundering'];
            const { riskItems } = aggregates;

            const tableBody = document.getElementById('riskTableBody');

            if (riskItems.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="3" style="text-align: center; color: var(--boosting); padding: 2rem;">
                            <strong>‚úì No RISK_SIGNAL responses detected</strong><br>
                            <span style="font-size: 0.8rem; color: var(--text-muted);">No genuine red flags found in AI responses.</span>
                        </td>
                    </tr>
                `;
                document.getElementById('riskCount').textContent = '0';
                return;
            }

            tableBody.innerHTML = riskItems.map(item => {
                // Extract trigger term
                const text = ((item.trigger_negative || '') + ' ' + (item.answer || '')).toLowerCase();
                let triggerTerm = 'risk indicator';
                for (const kw of riskKeywords) {
                    if (text.includes(kw)) {
                        triggerTerm = kw;
                        break;
                    }
                }

                // Extract evidence (first sentence with trigger)
                const sentences = (item.answer || '').split(/[.!?]+/);
                let evidence = '';
                for (const sentence of sentences) {
                    if (sentence.toLowerCase().includes(triggerTerm)) {
                        evidence = sentence.trim().substring(0, 80) + '...';
                        break;
                    }
                }

                return `
                    <tr class="risk-row">
                        <td>${item.question_text}</td>
                        <td><span style="background: var(--risk); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.7rem; text-transform: uppercase;">${triggerTerm}</span></td>
                        <td style="text-align: center;">
                            <button onclick="openModal('${item.id}')" style="background: var(--info-light); color: var(--info); border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.7rem;">View</button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('riskCount').textContent = riskItems.length;
        }

        function renderTable(filter = 'all', search = '') {
            let filtered = analysisData;

            // Update filter counts
            const counts = {
                all: analysisData.length,
                BOOSTING: 0,
                COMPETITIVE_LOSS: 0,
                RISK_SIGNAL: 0,
                FRICTION: 0,
                NEUTRAL: 0,
                NO_MENCIONA_LA_MARCA: 0
            };
            analysisData.forEach(item => {
                if (counts.hasOwnProperty(item.business_label)) counts[item.business_label]++;
            });
            document.getElementById('filterCountAll').textContent = counts.all;
            document.getElementById('filterCountBoosting').textContent = counts.BOOSTING;
            document.getElementById('filterCountCompetitive').textContent = counts.COMPETITIVE_LOSS;
            document.getElementById('filterCountRisk').textContent = counts.RISK_SIGNAL;
            document.getElementById('filterCountFriction').textContent = counts.FRICTION;
            document.getElementById('filterCountNeutral').textContent = counts.NEUTRAL;
            document.getElementById('filterCountInvisible').textContent = counts.NO_MENCIONA_LA_MARCA;

            if (filter !== 'all') {
                filtered = filtered.filter(item => item.business_label === filter);
            }

            if (search) {
                const searchLower = search.toLowerCase();
                filtered = filtered.filter(item =>
                    item.question_text.toLowerCase().includes(searchLower)
                );
            }

            const tbody = document.getElementById('evalTableBody');
            tbody.innerHTML = filtered.map((item, i) => {
                const rowClass = ['COMPETITIVE_LOSS', 'RISK_SIGNAL'].includes(item.business_label) ?
                    (item.business_label === 'RISK_SIGNAL' ? 'risk-row' : 'competitive-row') :
                    (item.business_label === 'BOOSTING' ? 'boosting-row' : '');

                // Format date
                const date = item.created_at ? new Date(item.created_at).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' }) : 'Jan 26';

                // Get trigger (positive or negative)
                const trigger = item.trigger_negative ? item.trigger_negative.substring(0, 40) + (item.trigger_negative.length > 40 ? '...' : '') :
                               (item.trigger_positive ? item.trigger_positive.substring(0, 40) + (item.trigger_positive.length > 40 ? '...' : '') : '-');

                return `
                    <tr class="${rowClass}">
                        <td style="font-size: 0.75rem; color: var(--text-muted);">${date}</td>
                        <td>${item.question_text}</td>
                        <td><span class="label-badge ${getLabelClass(item.business_label)}">${formatLabel(item.business_label)}</span></td>
                        <td style="font-size: 0.8rem;">${item.competitors ? item.competitors.split(';').slice(0, 2).join(', ') + (item.competitors.split(';').length > 2 ? '...' : '') : '-'}</td>
                        <td style="font-size: 0.75rem; color: var(--text-secondary);">${trigger}</td>
                        <td style="text-align: center;"><span style="background: #10a37f; color: white; padding: 0.15rem 0.35rem; border-radius: 4px; font-size: 0.65rem;">GPT</span></td>
                        <td style="text-align: center;">
                            <button onclick="openModal('${item.id}')" style="background: var(--info-light); color: var(--info); border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.7rem;">View</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function getLabelClass(label) {
            const map = {
                'BOOSTING': 'boosting',
                'COMPETITIVE_LOSS': 'competitive',
                'RISK_SIGNAL': 'risk',
                'FRICTION': 'friction',
                'NEUTRAL': 'neutral',
                'NO_MENCIONA_LA_MARCA': 'invisible'
            };
            return map[label] || 'neutral';
        }

        function formatLabel(label) {
            const map = {
                'BOOSTING': 'Boosting',
                'COMPETITIVE_LOSS': 'Competitive',
                'RISK_SIGNAL': 'Risk',
                'FRICTION': 'Friction',
                'NEUTRAL': 'Neutral',
                'NO_MENCIONA_LA_MARCA': 'Not Mentioned'
            };
            return map[label] || label;
        }

        function setupFilters() {
            const filters = document.querySelectorAll('.eval-filter');
            const searchInput = document.getElementById('evalSearch');

            filters.forEach(btn => {
                btn.addEventListener('click', () => {
                    filters.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderTable(btn.dataset.filter, searchInput.value);
                });
            });

            searchInput.addEventListener('input', () => {
                const activeFilter = document.querySelector('.eval-filter.active');
                renderTable(activeFilter.dataset.filter, searchInput.value);
            });
        }

        function setupScenario() {
            const toggle = document.getElementById('scenarioToggle');
            const content = document.getElementById('scenarioContent');
            const inputs = ['aiInfluence', 'dealSize', 'pipeline'];

            toggle.addEventListener('change', () => {
                content.classList.toggle('active', toggle.checked);
                if (toggle.checked) calculateScenario();
            });

            inputs.forEach(id => {
                document.getElementById(id).addEventListener('input', calculateScenario);
            });
        }

        function calculateScenario() {
            const aiInfluence = parseFloat(document.getElementById('aiInfluence').value) || 0;
            const dealSize = parseFloat(document.getElementById('dealSize').value) || 0;
            const pipeline = parseFloat(document.getElementById('pipeline').value) || 0;
            const resultEl = document.getElementById('scenarioResult');

            // Validation: if % = 0, output = 0
            if (aiInfluence === 0) {
                resultEl.textContent = '$0';
                resultEl.style.opacity = '0.5';
                return;
            }

            // Validation: if deal size empty, show disabled state
            if (dealSize === 0) {
                resultEl.textContent = 'Enter deal size';
                resultEl.style.opacity = '0.5';
                return;
            }

            if (pipeline === 0) {
                resultEl.textContent = '$0';
                resultEl.style.opacity = '0.5';
                return;
            }

            resultEl.style.opacity = '1';

            // Calculate negative signal percentage
            const negativeSignals = analysisData.filter(item =>
                ['COMPETITIVE_LOSS', 'RISK_SIGNAL', 'FRICTION'].includes(item.business_label)
            ).length;
            const negativePercent = (negativeSignals / analysisData.length) * 100;

            // Theoretical exposure = Pipeline * AI influence * negative signal rate
            const exposure = (pipeline * 1000000) * (aiInfluence / 100) * (negativePercent / 100);

            document.getElementById('scenarioResult').textContent = '$' + (exposure / 1000000).toFixed(1) + 'M';
        }

        function openModal(id) {
            const item = analysisData.find(d => d.id === id);
            if (!item) return;

            document.getElementById('modalTitle').textContent = item.question_text;
            document.getElementById('modalSignal').innerHTML = `<span class="label-badge ${getLabelClass(item.business_label)}">${formatLabel(item.business_label)}</span>`;

            // Decision rule based on label
            const decisionRules = {
                'BOOSTING': 'Rule 4 ‚Äî Clean positives (innovation, partnerships, awards) without meaningful disadvantages',
                'COMPETITIVE_LOSS': 'Rule 2 ‚Äî Criterion-based comparison where competitor positioned as stronger',
                'RISK_SIGNAL': 'Rule 1 ‚Äî True red flags (fraud, illegal, sanctions, investigation, lawsuit)',
                'FRICTION': 'Rule 3 ‚Äî Adoption barriers without clear competitor winner',
                'NEUTRAL': 'Rule 5 ‚Äî Factual/balanced/industry-standard information',
                'NO_MENCIONA_LA_MARCA': 'Rule 6 ‚Äî Brand not mentioned in response (visibility gap)'
            };
            document.getElementById('modalDecisionRule').textContent = decisionRules[item.business_label] || 'Classification rule applied';

            // Competitors
            const compSection = document.getElementById('modalCompetitorsSection');
            const compDiv = document.getElementById('modalCompetitors');
            if (item.competitors) {
                compSection.style.display = 'block';
                compDiv.innerHTML = item.competitors.split(';').filter(c => c.trim()).map(c =>
                    `<span class="modal-competitor-tag">${c.trim()}</span>`
                ).join('');
            } else {
                compSection.style.display = 'none';
            }

            // Triggers with highlighting
            const triggerSection = document.getElementById('modalTriggersSection');
            const triggerDiv = document.getElementById('modalTriggers');
            if (item.trigger_positive || item.trigger_negative) {
                triggerSection.style.display = 'block';
                triggerDiv.innerHTML = `
                    ${item.trigger_positive ? `<div class="modal-trigger-box positive"><strong>‚úÖ Positive Evidence:</strong><br><em>"${item.trigger_positive}"</em></div>` : ''}
                    ${item.trigger_negative ? `<div class="modal-trigger-box negative"><strong>‚ö†Ô∏è Negative Evidence:</strong><br><em>"${item.trigger_negative}"</em></div>` : ''}
                `;
            } else {
                triggerSection.style.display = 'none';
            }

            // Highlight trigger phrases in answer
            let answer = item.answer || 'No answer available';
            if (item.trigger_negative) {
                const phrases = item.trigger_negative.split(/[,;]/).map(p => p.trim()).filter(p => p.length > 5);
                phrases.forEach(phrase => {
                    const regex = new RegExp(`(${phrase.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                    answer = answer.replace(regex, '<mark style="background: #fecaca; padding: 0 2px;">$1</mark>');
                });
            }
            if (item.trigger_positive) {
                const phrases = item.trigger_positive.split(/[,;]/).map(p => p.trim()).filter(p => p.length > 5);
                phrases.forEach(phrase => {
                    const regex = new RegExp(`(${phrase.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                    answer = answer.replace(regex, '<mark style="background: #d1fae5; padding: 0 2px;">$1</mark>');
                });
            }

            document.getElementById('modalAnswer').innerHTML = answer;
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') closeModal();
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        // ============================================
        // NEXT ACTIONS - Data-bound from Top 3 Criteria
        // ============================================
        function renderNextActions() {
            const { criteria, competitorsByCriterion } = aggregates;

            // Get top 3 criteria
            const top3 = Object.entries(criteria)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3);

            // Playbooks for each criterion
            const playbooks = {
                "Implementation Speed / Onboarding": "Publish Time-to-Market benchmarks, create fast-track onboarding documentation, showcase 'go-live in X days' case studies",
                "Pricing Transparency / Cost": "Create modular pricing tiers page, publish public price ranges, develop ROI calculator for prospects",
                "Scalability / Flexibility": "Create 'Modular inside ecosystem' architecture page, publish API documentation, showcase enterprise scalability case studies",
                "CRM / Marketing Depth": "Publish gamification and retention feature comparisons, create CRM integration guides, showcase campaign automation capabilities",
                "Startup-Friendliness / Accessibility": "Create 'Startup Launch Pack' landing page, simplify onboarding for smaller operators, publish success stories from small operators",
                "Regulatory / Compliance Strength": "Create jurisdiction coverage matrix, publish compliance certifications, showcase multi-market launch case studies",
                "Content / Partnerships / Ecosystem": "Publish game provider partnerships list, create content aggregation comparison, showcase ecosystem breadth"
            };

            const actionsContainer = document.getElementById('nextActionsContainer');
            if (!actionsContainer) return;

            if (top3.length === 0) {
                actionsContainer.innerHTML = '<p style="color: var(--text-muted);">No criteria data available</p>';
                return;
            }

            actionsContainer.innerHTML = top3.map(([criterion, count], i) => {
                const competitorsForCriterion = competitorsByCriterion[criterion] || {};
                const topCompetitors = Object.entries(competitorsForCriterion)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3)
                    .map(([name]) => name)
                    .join(', ');

                const playbook = playbooks[criterion] || "Develop targeted content addressing this criterion";

                return `
                    <div style="background: white; border-radius: 12px; padding: 1.25rem; border-left: 4px solid var(--competitive); margin-bottom: 1rem;">
                        <div style="font-size: 0.7rem; text-transform: uppercase; color: var(--competitive); font-weight: 700; margin-bottom: 0.5rem;">Priority ${i + 1}</div>
                        <div style="font-size: 1.1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.75rem;">Win Back: ${criterion}</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                            <strong>Problem:</strong> AI positions <span style="color: var(--competitive);">${topCompetitors || 'competitors'}</span> ahead in ${criterion.toLowerCase()}
                        </div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.75rem;">
                            <strong>Evidence:</strong> ${count} competitive loss cases
                        </div>
                        <div style="font-size: 0.85rem; color: var(--info); background: var(--info-light); padding: 0.75rem; border-radius: 8px;">
                            <strong>Action:</strong> ${playbook}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ============================================
        // EXPORT CSV - All fields including criteria
        // ============================================
        function exportCSV() {
            const headers = ['id', 'question_text', 'business_label', 'secondary_label', 'presence', 'competitors', 'criteria', 'trigger_positive', 'trigger_negative', 'created_at', 'answer'];
            const csvContent = [headers.join(',')];
            analysisData.forEach(item => {
                const criterion = item.business_label === 'COMPETITIVE_LOSS' ? assignCriterion(item) : '';
                const row = headers.map(h => {
                    if (h === 'criteria') return '"' + (criterion || '') + '"';
                    const val = item[h] || '';
                    return '"' + String(val).replace(/"/g, '""') + '"';
                });
                csvContent.push(row.join(','));
            });
            downloadFile(csvContent.join('\n'), 'betconstruct_analysis.csv', 'text/csv');
        }

        // Export PDF (placeholder - opens print dialog)
        function exportPDF() {
            window.print();
        }

        // Copy shareable link
        function copyShareableLink() {
            const url = window.location.href.split('?')[0] + '?brand_id=betconstruct';
            navigator.clipboard.writeText(url).then(() => {
                alert('Link copied to clipboard!');
            });
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Brand ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const brandId = urlParams.get('brand_id') || 'betconstruct';

        // Initialize
        loadData();
    </script>
</body>
</html>
